#!/usr/local/bin/python2.7

from __future__ import print_function # 123

import sys
import os
import pyinstl

import platform
current_os = platform.system()
if current_os == 'Darwin':
    current_os = 'Mac'
    from pyinstl.instlInstance_mac import InstlInstance_mac as ii
elif current_os == 'Windows':
    current_os = 'Win'
    from pyinstl.instlInstance_win import InstlInstance_win as ii


from pyinstl.instlInstanceBase import InstallInstructionsState

def run_instl_instructions(instance):
    if "__MAIN_RUN_INSTALLATION__" in instance.cvl:
        from subprocess import Popen
        install_process = Popen(instance.out_file_realpath)
        stdout, stderr = install_process.communicate()

def main():
    try:
        instance = ii()
        instance.read_command_line_options(sys.argv[1:])
        if instance.mode == "batch":
            instance.do_command()
        elif instance.mode == "interactive":
            instance.do_da_interactive()
        elif instance.mode == "do_something":
            instance.do_something()
        #with open("var_assign.txt", "w") as fd:
        #    fd.write( os.linesep.join(sorted(instance.variables_assignment_lines)) )
        #run_instl_instructions(instance)
    except Exception as es:
        import traceback
        tb = traceback.format_exc()
        print(tb)
        #print("__main__", es)

if __name__ == "__main__":
    main()
